---
title: "Wykład VI - caret overview"
author: "Mateusz Sobieraj"
date: "10 maj 2018"
output: 
  ioslides_presentation:
    css: dependencies/styles.css
    logo: dependencies/grosz.png
logo: dependencies/grosz.png
smaller: yes
encoding: UTF-8
transition: slower
widescreen: no
---

```{r required_packages, include=FALSE, eval=TRUE}
library(dplyr)
library(tidyr)
library(ggplot2)
library(GGally)
library(caret)
iris_con <- iris %>% select(-Species)
iris_disc <- iris %>% select(Species) 
```

  
## Wizualizacja ggplot zamiast caret I

```{r prepare_my_plot}
my_plot <- function(data, mapping, ...) {
  ggplot(data = data, mapping = mapping) +
    geom_point(...) +
    geom_smooth(method = lm,
                se = FALSE,
                linetype = 2,
                color = "gray50") +
    stat_ellipse(type = "norm")
    
}
```

## Wizualizacja ggplot zamiast caret I

```{r pairs_code}
iris_pairs <- iris %>% 
  ggpairs(aes(fill = Species,
              colour = Species,
              alpha = .5,
              shape = Species),
          columns = 1:4,
          upper = list(continuous = "cor",
                       combo = "box",
                       discrete = "blank"),
          lower = list(continuous  = my_plot),
          diag = list())
```

## Wizualizacja ggplot zamiast caret I

```{r pairs_plot, echo=FALSE}
iris_pairs
```

## Wizualizacja ggplot zamiast caret II 

```{r density_code}
iris_density <- iris %>%
  gather(key = "faeture", value = "value", -Species) %>% 
  ggplot(aes(value, colour = Species, linetype = Species)) + 
  geom_density() +
  geom_rug() +
  facet_wrap(~faeture, nrow = 1) +
  theme(legend.position = "top", legend.box = "horizontal")
```

## Wizualizacja ggplot zamiast caret II 

```{r density_plot, echo=FALSE}
iris_density
```

## Wizualizacja ggplot zamiast caret III

```{r box_code}
iris_box <- iris %>%
  gather(key = "faeture", value = "value", -Species) %>% 
  ggplot(aes(Species, value)) + 
  geom_boxplot() +
  stat_summary(fun.y = mean, geom = "point", size = 2, colour = "red") +
  facet_wrap(~faeture, nrow = 1) +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))
```

## Wizualizacja ggplot zamiast caret III

```{r box_plot, echo=FALSE}
iris_box
```

## Wizualizacja ggplot zamiast caret IV

```{r scatter_code}
iris_scatter <- iris %>%
  ggplot(aes(Sepal.Length, Petal.Length)) + 
  geom_point(alpha = .5, colour = "#000000") +
    geom_smooth(method = "gam",
              se = FALSE,
              color = "#ff9060") +
  facet_wrap(~Species, nrow = 1)

```

## Wizualizacja ggplot zamiast caret IV

```{r scatter_plot, echo=FALSE}
iris_scatter
```


## Tworzenie zmiennych 0-1 z `dummyVars`

```{r}
iris %>%
  model.matrix(Species ~ . ^ 2, data = .) %>% as_tibble() %>% 
  as_tibble() %>% head()
```

## Tworzenie zmiennych 0-1 z `dummyVars`

```{r}
iris %>% 
  dummyVars(Sepal.Length ~ Species, data = .) %>% 
  predict(newdata = iris) %>% 
  as_tibble()
```

## `findCorrelation`

```{r}
corelation <- cor(iris_con)
findCorrelation(corelation, cutoff = 0.5)
```

## Dzielenie danych `createDataPartition` I

Zalety `createDataPartition` to

- wygoda
- dane podzielone sa rownómiernie
- sa zachowane proporcje w zbiorach

Wady 

- nie da się podzielić zbioru na trzy części

## Dzielenie danych `createDataPartition` I

```{r}

index <- createDataPartition(iris$Species, p = .6, list = F)

train <- iris %>% slice(index)
train_con <- iris_con %>% slice(index)
test <- iris %>% slice(-index)
test_con <- iris_con %>% slice(-index)
```


## Dzielenie danych `createDataPartition` II

Proporcje w grupie treningowej

```{r}
table(train$Species)
```


Proporcje w grupie testowej

```{r}
table(test$Species)
```

## Dzielenie danych `createDataPartition` III

```{r}
categories <- iris %>% 
    select(Species) %>%
    pull() %>%
    length() %>% 
    sample(1:3, ., replace = TRUE, prob = c(0.6, 0.3, 0.1))

idexes <- 
  sapply(1:3, function(flag, categories){
    which(categories %in% flag)  
  }, categories)

names(idexes) <- c("train", "test", "validation")
```

## Dzielenie danych `createDataPartition` III

Lista indexów

```{r, echo = FALSE}
idexes
```

Proporcje indexów

```{r, echo = FALSE}
idexes %>% sapply(length) / dim(iris)[1]
```


## `preProcess` I

Zastosowania funkcji `preProcess`

- skalowanie
- centrowanie
- transformacje zmiennych (`BoxCox`, `YeoJohnson` itp.)

## `preProcess` II

```{r}
preProcValues <- preProcess(train_con, method = c("center", "scale"))
predict(preProcValues, train_con)
predict(preProcValues, test_con)
```